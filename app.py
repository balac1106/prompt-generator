import streamlit as st
from templates import LEVELS, CATEGORIES, LANGUAGES, generate_all_prompts

# å„å•é¡Œé¡å‹å°æ‡‰çš„ç¯„ä¾‹æ–‡å­—ï¼ˆå¡«å…¥ç¯„ä¾‹æŒ‰éˆ•ç”¨ï¼‰
CATEGORY_EXAMPLES = {
    "é™¤éŒ¯": """æˆ‘åœ¨ç”¨ Python FastAPI å¯«ç™»å…¥ APIï¼Œrequest body ç”¨ Pydantic å®šç¾©æˆï¼š
class LoginRequest(BaseModel):
    username: str
    password: str

ä½†æ¯æ¬¡ POST éƒ½æ”¶åˆ° 422 Unprocessable Entityï¼Œæˆ‘é€çš„æ˜¯ JSONï¼š{"username": "test", "password": "123"}ã€‚
è«‹å•å¯èƒ½æ˜¯å“ªè£¡å‡ºå•é¡Œï¼Ÿ""",
    "åŠŸèƒ½é–‹ç™¼": """æˆ‘æƒ³ç”¨ Python åšä¸€å€‹ç°¡å–®çš„ CLI å·¥å…·ï¼šè®€å–ç•¶å‰è³‡æ–™å¤¾çš„ .csv æª”ï¼Œä¾æŒ‡å®šæ¬„ä½æ’åºå¾Œè¼¸å‡ºåˆ°æ–°çš„ csvã€‚
å¸Œæœ›æ”¯æ´ã€ŒæŒ‡å®šæ¬„ä½åç¨±ã€å’Œã€Œå‡åº/é™åºã€åƒæ•¸ï¼Œè«‹çµ¦æˆ‘å¯¦ä½œæ€è·¯å’Œç¯„ä¾‹ç¨‹å¼ç¢¼ã€‚""",
    "ç¨‹å¼ç¢¼å„ªåŒ–": """è«‹å¹«æˆ‘å„ªåŒ–é€™æ®µ Python ç¨‹å¼ç¢¼ï¼Œè®“å®ƒæ›´æ˜“è®€ã€æ›´å¥½ç¶­è­·ï¼š

def process(data):
    result = []
    for i in range(len(data)):
        if data[i]['status'] == 'active':
            result.append(data[i]['id'])
    return result""",
    "æŠ€è¡“é¸å‹": """æˆ‘å€‘åœ˜éšŠè¦é–‹ç™¼ä¸€å€‹æ–°æœå‹™ï¼šéœ€è¦è™•ç†å¤§é‡å³æ™‚äº‹ä»¶ï¼ˆç´„ 10k msg/sï¼‰ï¼Œåšç°¡å–®è½‰æ›å¾Œå¯«å…¥è³‡æ–™åº«ï¼Œä¸¦æä¾›æŸ¥è©¢ APIã€‚
åœ¨è€ƒæ…®ç”¨ Kafka + æŸå€‹å¾Œç«¯æ¡†æ¶ï¼Œè«‹å¹«æˆ‘æ¯”è¼ƒå¹¾ç¨®æŠ€è¡“çµ„åˆçš„å„ªç¼ºé»ä¸¦çµ¦å»ºè­°ã€‚""",
    "å­¸ç¿’è·¯ç·š": """æˆ‘å·²ç¶“æœƒ Python åŸºç¤èªæ³•å’Œå¯«éä¸€äº›å°è…³æœ¬ï¼Œæ¥ä¸‹ä¾†æƒ³å¾€å¾Œç«¯é–‹ç™¼ï¼ˆWeb APIï¼‰ç™¼å±•ï¼Œç›®æ¨™æ˜¯èƒ½ç¨ç«‹åšå‡ºå¯ä¸Šç·šçš„æœå‹™ã€‚
è«‹å¹«æˆ‘è¦åŠƒå­¸ç¿’è·¯ç·šå’Œæ¯å€‹éšæ®µå»ºè­°çš„ç·´ç¿’å°ˆæ¡ˆã€‚""",
    "ç³»çµ±è¨­è¨ˆ": """æˆ‘å€‘è¦åšä¸€å€‹ã€ŒçŸ­ç¶²å€ã€æœå‹™ï¼šç”¨æˆ¶è¼¸å…¥é•· URL å¾—åˆ°çŸ­ç¶²å€ï¼Œé»æ“ŠçŸ­ç¶²å€æœƒ 302 å°å‘åŸæœ¬çš„ URLã€‚
é ä¼°æ¯å¤©ç´„ 100 è¬æ¬¡ç”¢ç”Ÿã€1 å„„æ¬¡é»æ“Šï¼Œè«‹å¹«æˆ‘æ€è€ƒæ•´é«”æ¶æ§‹ã€å„²å­˜èˆ‡å¿«å–ç­–ç•¥ã€‚""",
    "Code Review": """è«‹å¹«æˆ‘ review é€™æ®µç¨‹å¼ç¢¼ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰ bugã€æ•ˆèƒ½å•é¡Œæˆ–å¯è®€æ€§å•é¡Œï¼š

def get_user_orders(user_id):
    orders = db.query("SELECT * FROM orders WHERE user_id = %s", (user_id,))
    for order in orders:
        order['items'] = db.query("SELECT * FROM order_items WHERE order_id = %s", (order['id'],))
    return orders""",
    "SAP é–‹ç™¼": """æˆ‘å€‘åœ¨ S/4HANA ä¸Šéœ€è¦ä¸€å€‹å ±è¡¨ï¼šä¾å…¬å¸ä»£ç¢¼ã€æœƒè¨ˆå¹´åº¦ï¼Œåˆ—å‡ºæ‡‰ä»˜å¸³æ¬¾æœªçµæ¸…çš„ä¾›æ‡‰å•†æ¸…å–®ï¼Œä¸¦é¡¯ç¤ºæœªçµé‡‘é¡ã€‚
è³‡æ–™ä¾†æºæ˜¯ BSIS/BSAK ç­‰ï¼Œè«‹å»ºè­°å¯¦ä½œæ–¹å¼ï¼ˆå ±è¡¨ç¨‹å¼ã€CDS æˆ–å…¶å®ƒï¼‰ä¸¦èªªæ˜æ³¨æ„äº‹é …ã€‚""",
}

# â”€â”€ é é¢è¨­å®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(
    page_title="å·¥ç¨‹å¸« AI æç¤ºè©ç”¢ç”Ÿå™¨",
    page_icon="ğŸ§‘â€ğŸ’»",
    layout="wide"
)

# â”€â”€ CSS æ¨£å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("""
<style>
    .main-title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 0.2rem;
    }
    .subtitle {
        color: #888;
        margin-bottom: 2rem;
    }
    .ai-label {
        font-size: 1.1rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    .tip-box {
        background-color: #1e1e2e;
        border-left: 4px solid #7c7cff;
        padding: 0.8rem 1rem;
        border-radius: 4px;
        margin-bottom: 1rem;
        font-size: 0.85rem;
        color: #ccc;
    }
    .stTabs [data-baseweb="tab"] {
        font-size: 1rem;
        font-weight: 600;
    }
</style>
""", unsafe_allow_html=True)

# â”€â”€ æ¨™é¡Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown('<div class="main-title">ğŸ§‘â€ğŸ’» å·¥ç¨‹å¸« AI æç¤ºè©ç”¢ç”Ÿå™¨</div>', unsafe_allow_html=True)
st.markdown('<div class="subtitle">æ ¹æ“šä½ çš„ç¨‹åº¦å’Œéœ€æ±‚ï¼Œè‡ªå‹•ç”¢ç”Ÿé©åˆå„å€‹ AI çš„æç¤ºè©</div>', unsafe_allow_html=True)

# â”€â”€ è¼¸å…¥å€å¡Š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.container():
    col1, col2, col3 = st.columns(3)

    with col1:
        level = st.selectbox(
            "ğŸ¯ ä½ çš„é–‹ç™¼ç¨‹åº¦",
            list(LEVELS.keys()),
            index=2,
            help="ç¨‹å¼æœƒæ ¹æ“šç¨‹åº¦èª¿æ•´æç¤ºè©çš„èªªæ˜æ·±åº¦"
        )

    with col2:
        language = st.selectbox(
            "ğŸ’» ä¸»è¦èªè¨€ / æŠ€è¡“",
            LANGUAGES,
            index=0,
            help="é¸æ“‡ä½ ä¸»è¦ä½¿ç”¨çš„ç¨‹å¼èªè¨€"
        )

    with col3:
        category = st.selectbox(
            "ğŸ“‚ å•é¡Œé¡å‹",
            CATEGORIES,
            index=0,
            help="é¸æ“‡ä½ çš„éœ€æ±‚å±¬æ–¼å“ªå€‹é¡å‹"
        )

st.markdown("---")

# å¡«å…¥ç¯„ä¾‹æŒ‰éˆ•ï¼šä¾ç›®å‰é¸æ“‡çš„ã€Œå•é¡Œé¡å‹ã€å¡«å…¥ç¯„ä¾‹æ–‡å­—
if st.button("ğŸ“‹ å¡«å…¥ç¯„ä¾‹", help="ä¾ä¸Šæ–¹é¸æ“‡çš„ã€Œå•é¡Œé¡å‹ã€å¡«å…¥ç¯„ä¾‹æè¿°ï¼Œå¯å†è‡ªè¡Œä¿®æ”¹"):
    example = CATEGORY_EXAMPLES.get(category, "")
    st.session_state["task_input"] = example
    st.rerun()

task = st.text_area(
    "ğŸ“ æè¿°ä½ çš„éœ€æ±‚æˆ–å•é¡Œ",
    placeholder="ä¾‹å¦‚ï¼šæˆ‘åœ¨ç”¨ Python å¯«ä¸€å€‹ FastAPI çš„ç™»å…¥åŠŸèƒ½ï¼Œä½†ä¸€ç›´æ”¶åˆ° 422 éŒ¯èª¤ï¼Œæˆ‘çš„ request body æ ¼å¼çœ‹èµ·ä¾†æ˜¯å°çš„...",
    height=140,
    key="task_input"
)

# é¸é …ï¼šä¸€ä½µè«‹æ±‚æ™‚åºåœ– / æµç¨‹åœ–ç­‰è¼”åŠ©æ–‡ä»¶
request_diagrams = st.checkbox(
    "ğŸ“Š è‹¥å¯èƒ½ï¼Œä¸€ä½µç”¢ç”Ÿæ™‚åºåœ–ã€æµç¨‹åœ–æˆ–æ¶æ§‹èªªæ˜ç­‰è¼”åŠ©æ–‡ä»¶",
    value=False,
    help="å‹¾é¸å¾Œï¼Œæç¤ºè©æœƒè«‹ AI è¦–æƒ…æ³ç”¢å‡º Mermaid æ™‚åºåœ–ã€æµç¨‹åœ–æˆ–ç°¡çŸ­æ¶æ§‹èªªæ˜ï¼Œæ–¹ä¾¿å°ˆæ¡ˆæˆå“¡ç†è§£"
)

# â”€â”€ ç”¢ç”ŸæŒ‰éˆ• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
generate = st.button("ğŸš€ ç”¢ç”Ÿæç¤ºè©", use_container_width=True, type="primary")

# â”€â”€ è¼¸å‡ºå€å¡Š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if generate:
    if not task.strip():
        st.warning("âš ï¸ è«‹å…ˆæè¿°ä½ çš„éœ€æ±‚æˆ–å•é¡Œï¼")
    else:
        prompts = generate_all_prompts(level, language, category, task, request_diagrams=request_diagrams)

        st.markdown("---")
        st.markdown("### âœ… ä½ çš„æç¤ºè©å·²ç”¢ç”Ÿï¼Œé»é¸å°æ‡‰çš„ AI åˆ†é è¤‡è£½ä½¿ç”¨")

        # AI é¢¨æ ¼èªªæ˜
        AI_TIPS = {
            "Claude": "å–œæ­¡æœ‰çµæ§‹çš„ XML æ¨™ç±¤æ ¼å¼ï¼Œçµ¦è¶Šå¤šèƒŒæ™¯è³‡è¨Šæ•ˆæœè¶Šå¥½",
            "ChatGPT": "å°è§’è‰²è¨­å®šå’Œ step-by-step æŒ‡ä»¤åæ‡‰å¼·",
            "Gemini": "å–œæ­¡ç°¡æ½”ç›´æ¥ï¼Œé‡é»ä¸€ç›®äº†ç„¶",
            "Grok": "å°è©±æ„Ÿå¼·ï¼Œç›´æ¥æœ‰è§€é»çš„æç¤ºè©æ•ˆæœæœ€å¥½",
        }

        tabs = st.tabs(list(prompts.keys()))

        for tab, (ai_name, prompt_text) in zip(tabs, prompts.items()):
            with tab:
                st.markdown(
                    f'<div class="tip-box">ğŸ’¡ <strong>{ai_name} å°æç¤ºï¼š</strong>{AI_TIPS[ai_name]}</div>',
                    unsafe_allow_html=True
                )
                st.code(prompt_text, language=None)

# â”€â”€ ä½¿ç”¨èªªæ˜ï¼ˆåº•éƒ¨ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.expander("â“ æ€éº¼ä½¿ç”¨é€™å€‹å·¥å…·ï¼Ÿ"):
    st.markdown("""
1. **é¸æ“‡ä½ çš„ç¨‹åº¦**ï¼šèª å¯¦é¸æ“‡ï¼Œç¨‹åº¦å½±éŸ¿æç¤ºè©çš„èªªæ˜æ·±åº¦
2. **é¸æ“‡èªè¨€å’Œé¡å‹**ï¼šç›¡é‡é¸å°æ‡‰çš„é¡å‹ï¼Œç”¢å‡ºæ•ˆæœæœƒæ›´å¥½
3. **æè¿°éœ€æ±‚**ï¼šè¶Šå…·é«”è¶Šå¥½ï¼ŒæŠŠä½ é‡åˆ°çš„æƒ…æ³ã€éŒ¯èª¤è¨Šæ¯éƒ½å¯«é€²å»
4. **é»é¸ç”¢ç”Ÿ**ï¼šç¨‹å¼æœƒè‡ªå‹•ç”¢å‡ºå››å€‹ AI ç‰ˆæœ¬çš„æç¤ºè©
5. **è¤‡è£½è²¼ä¸Š**ï¼šé»å³ä¸Šè§’çš„è¤‡è£½æŒ‰éˆ•ï¼Œç›´æ¥è²¼åˆ°å°æ‡‰çš„ AI å°±èƒ½ç”¨

**ç‚ºä»€éº¼ä¸åŒ AI æœ‰ä¸åŒç‰ˆæœ¬ï¼Ÿ**
æ¯å€‹ AI å°æç¤ºè©çš„ã€Œå£å‘³ã€ç¨å¾®ä¸åŒï¼Œé‡å°æ€§åœ°æ ¼å¼åŒ–å¯ä»¥è®“å›ç­”å“è³ªæ›´å¥½ã€‚
""")
